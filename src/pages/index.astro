---
import { getCollection } from "astro:content";
import Layout from "@layouts/Layout.astro";
import Header from "@components/Header.astro";
import Footer from "@components/Footer.astro";
import LinkButton from "@components/LinkButton.astro";
import Hr from "@components/Hr.astro";
import Card from "@components/Card";
import Hero from "@components/Hero.astro";
import Socials from "@components/Socials.astro";
import getSortedPosts from "@utils/getSortedPosts";
import { SOCIALS } from "@config";
import socialIcons from "@assets/socialIcons";

const posts = await getCollection("blog");

const sortedPosts = getSortedPosts(posts);
const featuredPosts = sortedPosts.filter(({ data }) => data.featured);
const recentPosts = sortedPosts.filter(({ data }) => !data.featured);

const socialCount = SOCIALS.filter(social => social.active).length;
---

<Layout>
  <Header />
  <main id="main-content">
    <section id="hero">
      <div class="md:flex-row flex flex-col gap-4">
        <div class="flex-1">
          <p>
            Hi 👋🏻, welcome! I'm Arach, a software engineer (4x startup CTO, 2x
            founder) currently hanging out in SF and spending most of my time
            🏃🏻running, 🏊🏻 swimming, hooping 🏀 and most importantly coding 👨🏻‍💻.
            I've spent most of my career building startups from the ground up
            but most recently spent some time at Facebook, where I led
            engineering teams working on various creator initiatives, most
            notably: Bulletin a publishing platform for independent authors and
            FB Creators Support & Education.
          </p>
          <p>
            Prior to that, I co-founded Breathe Life, an InsurTech startup that
            developed an industry leading hybrid distribution model for life
            insurance carriers and agencies. It was an awesome experience to go
            from inception to mid 8 figures exit in just 4 years! I'm super
            excited about building software, so much that I have carved out time
            to just build stuff and really get a feel for how to build in 2024
            and onwards. Back to the future.
          </p>
          <div>
            If you're building cool stuff, or invest in cool stuff, please reach
            out 🚀
          </div>
          {
            // only display if at least one social link is enabled
            socialCount > 0 && (
              <div class="social-wrapper">
                <div class="social-links">Social Links:</div>
                <Socials />
              </div>
            )
          }
        </div>
        <div class="md:flex hidden max-w-lg">
          <Hero
            imageUrl={"/assets/arach-filter.png"}
            onHoverImageUrl={"/assets/arach-filter-hover.png"}
          />
        </div>
      </div>

      <Hr noPadding={true} />

      {
        featuredPosts.length > 0 && (
          <>
            <section id="featured">
              <h2>Featured Posts</h2>
              <ul>
                {featuredPosts.map(({ data, slug }) => (
                  <Card
                    href={`/posts/${slug}/`}
                    frontmatter={data}
                    secHeading={false}
                  />
                ))}
              </ul>
            </section>
            {recentPosts.length > 0 && <Hr />}
          </>
        )
      }

      {
        recentPosts.length > 0 && (
          <section id="recent-posts">
            <h2>Recent Posts</h2>
            <ul>
              {recentPosts.map(
                ({ data, slug }, index) =>
                  index < 4 && (
                    <Card
                      href={`/posts/${slug}/`}
                      frontmatter={data}
                      secHeading={false}
                    />
                  )
              )}
            </ul>
          </section>
        )
      }

      <div class="all-posts-btn-wrapper">
        <LinkButton href="/posts/">
          All Posts
          <svg xmlns="http://www.w3.org/2000/svg"
            ><path
              d="m11.293 17.293 1.414 1.414L19.414 12l-6.707-6.707-1.414 1.414L15.586 11H6v2h9.586z"
            ></path>
          </svg>
        </LinkButton>
      </div>
    </section>

    <Footer />
  </main>

  <style>
    /* ===== Hero Section ===== */
    #hero {
      @apply pb-6 pt-8;
    }
    #hero h1 {
      @apply my-4 inline-block text-3xl font-bold sm:my-8 sm:text-5xl;
    }
    #hero .rss-link {
      @apply mb-6;
    }
    #hero .rss-icon {
      @apply mb-2 h-6 w-6 scale-110 fill-skin-accent sm:mb-3 sm:scale-125;
    }
    #hero p {
      @apply my-2;
    }
    .social-wrapper {
      @apply mt-4 flex flex-col sm:flex-row sm:items-center;
    }
    .social-links {
      @apply mb-1 mr-2 whitespace-nowrap sm:mb-0;
    }

    /* ===== Featured & Recent Posts Sections ===== */
    #featured,
    #recent-posts {
      @apply pb-6 pt-12;
    }
    #featured h2,
    #recent-posts h2 {
      @apply text-2xl font-semibold tracking-wide;
    }
    .all-posts-btn-wrapper {
      @apply my-8 text-center;
    }
  </style>
</Layout>
